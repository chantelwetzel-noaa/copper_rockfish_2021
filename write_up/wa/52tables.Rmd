\clearpage
# Tables

<!-- ======================================================= -->
<!-- ***************    Catches      *********************** --> 
<!-- ======================================================= -->

\input{C:/Assessments/2021/copper_rockfish_2021/write_up/wa/tex_tables/Catches_All_Years.tex}

\newpage


```{r}
tab = data.frame(Year = model$catch[model$catch$Fleet == 1, "Yr"],
                    Numbers = model$catch[model$catch$Fleet == 1, "Obs"] * 1000,
                    MT = model$catch[model$catch$Fleet == 1, "kill_bio"])
col_names = c("Year", "Numbers of Fish", "Metric Tons")
table_format(x = tab,
			caption = 'Input numbers of fish removals converted to metric tons (mt) within the model.',
			label = 'nums-mt',
			longtable = TRUE,
            digits = c(0, 0, 2),
			col_names = col_names)
```
\newpage


```{r, results = 'asis'}
yrs = hist = 2011:2020
nfleets = 2
catch = dead = total.dead = 0
for (i in 1:nfleets){
  name = paste0("retain(B):_",i)
  input.catch = model$timeseries[model$timeseries$Yr %in% yrs, name]
  catch = cbind(catch, input.catch)
}
total.catch <- round(apply(catch, 1, sum),2)

man = read.csv("//nwcfile/FRAM/Assessments/CurrentAssessments/DataModerate_2021/copper_rockfish/management/copper_north.csv")
man = man[man$Year %in% yrs, ]
out = cbind(man, round(man$ACL * 0.26, 2), total.catch)

col_names = c("Year", "OFL", "ACL", "WA ACL", "WA Removals")

table_format(x = out,
             caption = "The OFL and ACL for north nearshore, the ACL allocated to Washington, and the total removals.",
             label = "ofl",
             align = 'l',
             col_names = col_names)

```


<!-- ======================================================= -->
<!-- ***************       Data      *********************** --> 
<!-- ======================================================= -->

\input{C:/Assessments/2021/copper_rockfish_2021/write_up/wa/tex_tables/len_at_age_data.tex}

\newpage

\input{C:/Assessments/2021/copper_rockfish_2021/write_up/wa/tex_tables/wa_samples.tex}

\newpage

\input{C:/Assessments/2021/copper_rockfish_2021/write_up/wa/tex_tables/wa_age_samples.tex}

\newpage

<!-- ======================================================= -->
<!-- ***************    Biology      *********************** --> 
<!-- ======================================================= -->

```{r, results = 'asis'}

ests = 
matrix(c(c("Female", "L1", round(model$MGparmAdj$L_at_Amin_Fem_GP_1[1], 1), "External Estimate"),
c("", "L2",round(model$MGparmAdj$L_at_Amax_Fem_GP_1[1], 1), "External Estimate"),
c("", "k", round(model$MGparmAdj$VonBert_K_Fem_GP_1[1], 3), "External Estimate"),
c("", "alpha", format(model$MGparmAdj$Wtlen_1_Fem[1], scientific = TRUE), "External Estimate"),
c("", "beta", round(model$MGparmAdj$Wtlen_2_Fem[1],2), "External Estimate"),
c("", "length at 50% maturity", round(model$MGparmAdj[,"Mat50%_Fem_GP_1"][1],2), "Hannah 2014"),
c("", "maturity slope", round(model$MGparmAdj$Mat_slope_Fem_GP_1[1], 2), "Hannah 2014"),
c("", "eggs scalar", format(model$MGparmAdj$Eggs_scalar_Fem[1], scientific = TRUE), "Dick et al. 2017"),
c("", "eggs exponent", round(model$MGparmAdj$Eggs_exp_len_Fem[1], 2), "Dick et al. 2017"),
c("Male", "L1", round(model$MGparmAdj$L_at_Amin_Mal_GP_1[1], 1), "External Estimate"),
c("", "L2", round(model$MGparmAdj$L_at_Amax_Mal_GP_1[1], 1), "External Estimate"),
c("", "k",  round(model$MGparmAdj$VonBert_K_Mal_GP_1[1], 3), "External Estimate"),
c("", "alpha", format(model$MGparmAdj$Wtlen_1_Mal[1], scientific = TRUE), "External Estimate"),
c("", "beta", round(model$MGparmAdj$Wtlen_2_Mal[1],2), "External Estimate")), ncol = 4, byrow = TRUE)

col_names = c("Sex", "Parameter", "Value", "Source")

#table_format(x = ests,
             #caption = "List of biological parameters by sex and source.",
             #label = "bio-params",
             #align = "l",
             #col_names = c("Sex", "Parameter", "Value", "Source"),            
             #longtable = TRUE)

```

\newpage

<!-- ======================================================= -->
<!-- ***********   Model Parameters     ******************** --> 
<!-- ======================================================= -->


```{r, results = 'asis'}

mod_params = model$parameters[-c(grep('Dev',model$parameters$Label),
                                 grep('Early', model$parameters$Label),
								 grep('Fore',model$parameters$Label),	
								 grep('Impl',model$parameters$Label)),
                                (names(model$parameters) %in%
                                c("Num","Label","Value","Phase","Min",
                                  "Max","Status","Parm_StDev",
                                  "Pr_type","Prior","Pr_SD"))] 

mod_params[,'Value'] = round(as.numeric(mod_params[,'Value']),3)                                 

# Combine bounds into one column
mod_params$Min = paste('(', mod_params$Min, ', ', mod_params$Max, ')', sep='')

# Combine prior info to one column
mod_params$PR_type = ifelse(mod_params$Pr_type == 'No_prior' , 'None', paste(mod_params$Pr_type,' (', mod_params$Prior,  ', ', mod_params$Pr_SD, ')', sep = ''))

# Set long value to scientific notation
mod_params[mod_params$Label == "Wtlen_1_Fem",3] = format(mod_params[mod_params$Label == "Wtlen_1_Fem",3], scientific = TRUE)
mod_params[mod_params$Label == "Wtlen_1_Mal",3] = format(as.numeric(mod_params[mod_params$Label == "Wtlen_1_Mal",3]), scientific = TRUE)
mod_params[mod_params$Label == "Eggs_scalar_Fem",3] = format(as.numeric(mod_params[mod_params$Label == "Eggs_scalar_Fem",3]), scientific = TRUE)
mod_params[mod_params$Label == "L_at_Amax_Mal_GP_1",3] = round(as.numeric(mod_params[mod_params$Label == "L_at_Amax_Mal_GP_1",3]), 4)
mod_params[mod_params$Label == "VonBert_K_Mal_GP_1",3] = round(as.numeric(mod_params[mod_params$Label == "VonBert_K_Mal_GP_1",3]), 3)
mod_params[mod_params$Label == "CV_old_Mal_GP_1",3] = round(as.numeric(mod_params[mod_params$Label == "CV_old_Mal_GP_1",3]), 3)

# Remove the max, prior and prior sd columns
drops = c('Max', 'Prior', 'Pr_type', 'Pr_SD', 'Num')
mod_params = mod_params[, !(names(mod_params) %in% drops)]
rownames(mod_params) = c()
mod_params[,"Label"] = gsub("\\_", " ", mod_params[,"Label"])
mod_params[,"PR_type"] = gsub("\\_", " ", mod_params[,"PR_type"])

# Add column names
col_names = c('Parameter',
                         'Value',
                         'Phase',
                         'Bounds',
                         'Status',
                         'SD',
                         'Prior (Exp.Val, SD)')

table_format(x = mod_params,
             caption = "List of parameters used in the base model, including estimated values and standard deviations (SD), bounds (minimum and maximum), estimation phase (negative values not estimated), status (indicates if parameters are near bounds), and prior type information (mean and SD).",
             label = "params",
             align = 'l',
             col_names = col_names,
             longtable = TRUE,
             font_size = 9,
             landscape = TRUE,
             custom_width = TRUE,
             col_to_adjust = c(1,7), 
             width = c("6cm", "4cm"))                         

```

<!-- ======================================================= -->
<!-- ***********       Likelihood       ******************** --> 
<!-- ======================================================= -->

\include{tex_tables/likelihoods.tex}



<!-- ======================================================= -->
<!-- ***********       Time Series      ******************** --> 
<!-- ======================================================= -->

\input{C:/Assessments/2021/copper_rockfish_2021/write_up/wa/tex_tables/TimeSeries.tex}

\newpage

<!-- ======================================================= -->
<!-- ****************     Sensitivities      *************** --> 
<!-- ======================================================= -->

\input{C:/Assessments/2021/copper_rockfish_2021/write_up/wa/tex_tables/sensitivities.tex}

\newpage


```{r, results = 'asis'}
tab = read.csv(file.path(mod_loc, 'tables', 'data_weights.csv'))
col_names = c('Method',
              'Recreational Lengths')
table_format(x = tab,
             caption = "Data weights applied by each alternative data weighting methods.",
             label = "dw",
             align = 'l',
             col_names = col_names)
```

\newpage


<!-- ======================================================= -->
<!-- ********  Reference Points & Management *************** --> 
<!-- ======================================================= -->

\input{C:/Assessments/2021/copper_rockfish_2021/write_up/wa/tex_tables/e_ReferencePoints_ES.tex}

\newpage


```{r, results = 'asis'}
tab = read.csv(file.path(mod_loc, 'tables', 'g_Projections_ES.csv'))
man = read.csv("//nwcfile/FRAM/Assessments/CurrentAssessments/DataModerate_2021/copper_rockfish/management/copper_north.csv")

out = cbind(tab$Year,
            c(man[man$Year %in% c(2021, 2022), "OFL"], rep("-",10)),
            c(man[man$Year %in% c(2021, 2022), "ACL"], rep("-",10)),
            c(man[man$Year %in% c(2021, 2022), "ACL"] * 0.26, rep("-", 10)),
            c(rep("-",2), round(tab[3:12,2], 2)),
            c(rep("-",2), round(tab[3:12,3],2)),
            c(rep("-",2), round(tab[3:12,3]/tab[3:12,2], 3)),
            round(tab[ ,5:ncol(tab)], 2))

col_names = c('Year',
              'Complex OFL',
              'Complex ACL',
              "WA ACL",
              "OFL", 
              "ABC", 
              "ABC/OFL",
              "Spawning Output",
              "Fraction Unfished")
table_format(x = out,
             caption = "Projections of potential OFLs (mt), ABCs (mt), estimated spawning output, and fraction unfished. The OFL, ACL, and Washington (WA) ACL for 2021 and 2022 reflect adopted management limits.",
             label = "project",
             align = 'l',
             col_names = col_names)
```

\newpage