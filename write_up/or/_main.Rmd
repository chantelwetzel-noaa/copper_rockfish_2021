---
geometry: margin=1in
month: "`r format(Sys.Date(), '%B')`"
year: "`r format(Sys.Date(), '%Y')`"
preamble: |
output: sa4ss::techreport_pdf
bibliography: sa4ss.bib
lang: en
papersize: a4
---

```{r opts, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
knitr::knit_hooks$set(plot = function(x,options) {
      base = knitr::opts_knit$get('base.url')
      if (is.null(base)) base = ''
      alt = ifelse (is.null(options$alt),"",options$alt)
      cap = ifelse (is.null(options$caption),"",options$caption)
      if (alt != ""){
        sprintf('![%s](%s%s "%s")', cap, base, x, alt)
      } else {
        sprintf('![%s](%s%s)', cap, base, x)  
        }
  })

load("00opts.Rdata")

spp = 'copper rockfish'
Spp = 'Copper rockfish'

data_fig_loc = "//nwcfile/FRAM/Assessments/CurrentAssessments/DataModerate_2021/copper_rockfish/data/biology/plots"

if(file.exists("00mod.Rdata")){
  load("00mod.Rdata")
} else {
  print("Model output not being read. Please run the read_model() function.")
}

```

<!--chapter:end:00a.Rmd-->

---
author:
  - name: Chantel R. Wetzel
    code: 1
    first: C
    middle: R
    family: Wetzel
  - name: Brian J. Langseth
    code: 1
    first: B
    middle: J
    family: Langseth
  - name: Jason M. Cope
    code: 1
    first: J
    middle: M
    family: Cope
  - name: Alison D. Whitman
    code: 2
    first: A
    middle: D
    family: Whitman
author_list: Wetzel, C.R., B.J. Langseth, J.M. Cope, A.D. Whitman
affiliation:
  - code: 1
    address: Northwest Fisheries Science Center, U.S. Department of Commerce, National
      Oceanic and Atmospheric Administration, National Marine Fisheries Service, 2725
      Montlake Boulevard East, Seattle, Washington 98112
  - code: 2
    address: Oregon Department of Fish and Wildlife, 2040 Southeast Marine Science
      Drive, Newport, Oregon 97365
address:
  - ^1^Northwest Fisheries Science Center, U.S. Department of Commerce, National Oceanic
    and Atmospheric Administration, National Marine Fisheries Service, 2725 Montlake
    Boulevard East, Seattle, Washington 98112
  - ^2^Oregon Department of Fish and Wildlife, 2040 Southeast Marine Science Drive,
    Newport, Oregon 97365
---

<!--chapter:end:00authors.Rmd-->

---
title: The status of copper Rockfish (_Sebastes caurinus_) along the Oregon U.S. West Coast in 2020 using catch and length data
---

<!--chapter:end:00title.Rmd-->

\pagebreak
\pagenumbering{roman}
\setcounter{page}{1}

<!--chapter:end:01a.Rmd-->


<!--chapter:end:01executive.Rmd-->

\pagebreak
\setlength{\parskip}{5mm plus1mm minus1mm}
\pagenumbering{arabic}
\setcounter{page}{1}
\renewcommand{\thefigure}{\arabic{figure}}
\renewcommand{\thetable}{\arabic{table}}
\setcounter{table}{0}
\setcounter{figure}{0}

\setlength\parskip{0.5em plus 0.1em minus 0.2em}

<!--chapter:end:10a.Rmd-->

# Introduction

```{r, echo=FALSE, results='asis'}
general_wd = "C:/Assessments/2021/copper_rockfish_2021/write_up/general_text"
filein = file.path(general_wd,'1_intro_life_history_fishery_info.Rmd')
read_child(filein)
```

## Historical and Current Fishery Information

Off the coast of Oregon State `r spp` is primarily caught in by both commercial and recreational fisheries. The landings from the commercial fishery were minimal until the mid-1980s. Currently, `r spp` is landed as part of both the live and dead commercial fishery off the coast of Oregon. The recreational fishery off the coast of Oregon begun in 1979 and removals from the recreational fleet has increased across time. 

The stock off the Oregon coast was assessed as a separate stock from other populations off the West Coast based on fairly sedentary nature of `r spp` which likely limits flow of fish between California and Washington. The substrate of the southern Washington coast is typically sandy bottom, which creates a natural separation between the Oregon and Washington populations. Additionally, the exploitation history and magnitude of removals off the Oregon coast has been dramatically lower than removals off the California coast.    


## Summary of Management History and Performance

```{r, echo=FALSE, results='asis'}
general_wd = "C:/Assessments/2021/copper_rockfish_2021/write_up/general_text"
filein = file.path(general_wd,'1_intro_management.Rmd')
read_child(filein)
```


<!--chapter:end:11introduction.Rmd-->

# Data
A description of each data source is provided below (Figure \ref{fig:data-plot}).

<!--chapter:end:20data.Rmd-->

## Fishery-Dependent Data

### Commercial Fishery

State description of recreational removal data --- To be provided by Ali.

Figure \ref{fig:catch}

The input catches in the model represent total removals: landings plus discards.  Discards totals for the commercial fleet from 2002-2019 were determined based on West Coast Groundfish Observer Program (WCGOP) data provided in the Groundfish Expanded Mortality Multiyear (GEMM) product. The total coastwide observed discards were allocated to state and area based on the total observed landings observed by WCGOP. The historical commercial discard mortality used to adjust the landings data to account for total removals was calculated based on the average coastwide discard rates from WCGOP of 4.4 percent. 

Table \ref{tab:com-len-samps}

Figure \ref{fig:com-len-data}

Figure \ref{fig:mean-com-len-data}

The input sample sizes were calculated via the Stewart method (Ian Stewart, personal communication, IPHC):

\begin{centering}

Input effN = $N_{\text{trips}} + 0.138 * N_{\text{fish}}$ if $N_{\text{fish}}/N_{\text{trips}}$ is $<$ 44

Input effN = $7.06 * N_{\text{trips}}$ if $N_{\text{fish}}/N_{\text{trips}}$ is $\geq$ 44

\end{centering}


### Recreational Fishery

State description of recreational removal data --- To be provided by Ali.

The removals in RecFIN used from 2001-2020 represent total removals consisting of both landings and estimated discard mortality. The removals for 1999 and prior were obtained from the Oregon Department of Fish and Wildlife Sport Reconstruction. No recreational discarding was assumed for these years because the bag limits during this period were not thought to be low enough (15 fish bag limit) to induce the likelihood of appreciable discarding of `r spp`.

Table \ref{tab:len-samps}

Figure \ref{fig:rec-len-data}

Figure \ref{fig:mean-rec-len-data}

The input sample sizes were calculated equal to the number of length samples available by year. 

<!--chapter:end:21f-.Rmd-->

## Fishery-Independent Data

There were no fishery-independent data sources that are commonly incorporated in West Coast groundfish assessments (as required by the data moderate Terms of Reference) available for `r spp` off the Oregon coast to be considered for this assessment.

<!--chapter:end:21s-.Rmd-->

## Biological Data


```{r, echo=FALSE, results='asis'}
filein = file.path(general_wd,'data_m.Rmd')
read_child(filein)
```

### Length-Weight Relationship

```{r, echo=FALSE, results='asis'}
filein = file.path(general_wd,'data_length_weight.Rmd')
read_child(filein)
```

### Growth (Length-at-Age)

```{r, echo=FALSE, results='asis'}
filein = file.path(general_wd,'data_length_age.Rmd')
read_child(filein)
```

### Maturation and Fecundity

```{r, echo=FALSE, results='asis'}
filein = file.path(general_wd,'data_fecund_mat.Rmd')
read_child(filein)
```

### Sex Ratio

```{r, echo=FALSE, results='asis'}
filein = file.path(general_wd,'data_sex_ratio.Rmd')
read_child(filein)
```

<!--chapter:end:22biology.Rmd-->

# Assessment Model

## Summary of Previous Assessments 

`r Spp` was last assessed in 2013 [@cope_data-moderate_2013]. The stock was assessed using extended depletion-based stock reduction analysis (XDB-SRA) a data-moderate approach which incorporated catch and index data with prior on select parameters (natural mortality, stock status in a specified year, productivity, and the relative status of maximum productivity). `r Spp` was assessed as two separated stocks, the area South of Pt. Conception off the California coast and the area North of Pt. Conception to the Washington Canada border. The 2013 assessment estimated the stock South of Pt. Conception at 75% of unfished spawning output North of Pt. Conception at 48% of unfished spawning output. 

### Bridging Analysis

A direct bridging analysis was not conducted because the previous assessment was structured to include the area from North of Pt. Conception to the Washington/Canadian border.  


## Model Structure and Assumptions

The Oregon `r spp` area assessed using a two-sex model with sex specific life history parameters.  The model assumed two fleets: 1) commercial and 2) recreational fleets with removals beginning in `r startyr`. Selectivity was specified using the double normal parameterization within SS for the commercial fleet where selectivity was fixed to be asymptotic with the ascending slope and size of maximum selectivity parameters estimated.  The recreational fleet also used a double normal parameterization with two selectivity shapes estimated for the period of `r startyr` to 1999 and 2000 to `r endyr`. The selectivity in the early period was fixed asymptotic and the selectivity in the final period was allowed estimate reduced selectivity for the largest fish (dome-shaped).  Annual recruitment deviations were allowed to vary by year. 

### Modeling Platform and Structure

Stock Synthesis version 3.30.16 was used to estimate the parameters in the model. The R package r4ss, version 1.38.0, along with R version 4.0.1 were used to investigate and plot model fits. 

### Priors

```{r, echo=FALSE, results='asis'}
general_wd = "C:/Assessments/2021/copper_rockfish_2021/write_up/general_text"
filein = file.path(general_wd,'model_priors.Rmd')
read_child(filein)
```  

### Data Weighting

Length composition data for the comercial fishery started with a sample size determined from the equation listed in Sections \ref{commercial-fishery}. The input sample size for the recreational fishery length composition data was set equal to the number of length samples by year.   

The base  model was weighted using the "Francis method", which was based on equation TA1.8 in Francis [-@francis_data_2011]. This formulation looks at the mean length or age and the variance of the mean to determine if across years, the variability is explained by the model. If the variability around the mean does not encompass the model predictions, then that data source should be down-weighted. This method accounts for correlation in the data (i.e., the multinomial distribution). Sensitivities were performed examing the difference in weighting using McAllister-Ianelli Harmonic Mean Weighting[-@mcallister_bayesian_1997] and the Dirichlet Multinomial Weighting [-@thorson_model-based_2017].

### Estimated and Fixed Parameters

There were 113 estimated parameters in the base model. These included one parameter for $R_0$, 6 parameters for selectivity and time blocking of the fleets, 94 recruitment deviations, and 12 forecast recruitment deviations (Table \ref{tab:params}).

Fixed parameters in the model were as follows. Steepness was fixed at `r print(model$parameters[model$parameters$Label == "SR_BH_steep","Value"],2)`. A sensitivity analysis and a likelihood profile were performed for steepness. Natural mortality was fixed at `r round(model$parameters[model$parameters$Label == "NatM_p_1_Fem_GP_1","Value"],3)` yr^-1^ for females and males, which is the median of the prior.  The standard deviation of recruitment deviates was fixed at `r print(model$parameters[model$parameters$Label == "SR_sigmaR","Value"],2)`. Growth, maturity-at-length, and length-at-weight was fixed as described above in Section \ref{data}. 

Dome-shaped selectivity was explored for all fleets within the model. Older `r spp` are often found in deeper waters and may move into areas that limit their availability to fishing gear. The final base model estimated dome-shaped selectivity for only the largest fish in recent years for the recreational fishery.  The selectivties for the commercial fishery and early recreational fishery (1927-1999) were fixed to be asymptotic.


## Model Selection and Evaluation

The base assessment model for `r spp` was developed to balance parsimony and realism, and the goal was to estimate a spawning output trajectory for the population of `r spp` off the Washington coast. The model contains many assumptions to achieve parsimony and uses many different sources of data to estimate reality. A series of investigative model runs were done to achieve the final base model.



<!--chapter:end:30model.Rmd-->

## Base Model Results

The base model parameter estimates along with approximate asymptotic standard errors are shown in Table \ref{tab:params} and the likelihood components are shown in Table \ref{tab:likes}. Estimates of derived reference points and approximate 95 percent asymptotic confidence intervals are shown in Table \ref{tab:referenceES}. Estimates of stock size and status over time are shown in Table \ref{tab:timeseries}. 

### Parameter Estimates

Estimated parameter values are provided in Table \ref{tab:params}. The model estimated 113 total parameters: $R_0$, 6 selectivity parameters, and 106 parameters for annual recruitment deviations.  The $R_0$ was estimated at `r round(model$parameters[model$parameters$Label == 'SR_LN(R0)', 'Value'], 2)`. The selectivity curves for the commercial and recreational fleet is shown in Figure \ref{fig:selex}. The selectivity was fixed to be asymptotic for the commercial fleet with a peak in maximum selectivity for fish at `r round(model$parameters[model$parameters$Label == 'Size_DblN_peak_OR_Commercial(1)', 'Value'], 1)` cm.  The selectivity for the recreational fleet was estimated for two separate periods 1927 - 1999 and 2000 - 2020.  The blocks in selectivity captured a shift in recreational fishing behavior before and after the implementation of bag limits in the Oregon recreational fishery. Prior to implementation of bag limits the peak size of selectivity was estimated at `r round(model$parameters[model$parameters$Label == 'Size_DblN_peak_OR_Recreational(2)_BLK1repl_1927', 'Value'], 1)` cm with the peak of selectivity shifting to select larger fish (`r round(model$parameters[model$parameters$Label == 'Size_DblN_peak_OR_Recreational(2)_BLK1repl_1927', 'Value'], 1)` cm) after 1999 with a decreasing selectivity of the largest fish. 

### Fits to the Data

Fits to the length data are shown based on the Pearson residuals-at-length, the annual mean lengths, and aggregated length composition data for the commercial and recreational fleets. The Person residuals for the commercial fishery have no discernable pattern of misfit to the length data (Figure \ref{fig:com-pearson}). The largest residual was observed in 2017 for male fish where there was a spike of male observations but no similar spike for female fish of a similar size within that year (see [Appendix A](#append_a) for details).  The mean lengths observed by the commercial fishery were variable by year with fairly large confidence intervals (Figure \ref{fig:com-mean-len-fit}). 

The Pearson residuals for the recreation length data are variable by year an sex (Figure \ref{fig:rec-pearson}). The early data years show a slight pattern of postive and negative residuals between large and small fish, however, the quantity of samples from these years were limited (Table \ref{tab:len-samps}) and the data reflected a wide distribution of lengths being observed (Figure \ref{fig:rec-len-data}). The mean length obseved across years with data variable prior to 2000 with a lower mean length (Figure \ref{fig:rec-mean-len-fit}). Around the year 2000, the mean length shifted to a larger size (around 40 cm) with a decreased variation in the observed lengths (Figure \ref{fig:rec-mean-len-fit}). 

Detailed fits to the length data by year are provided in [Appendix A](#append_a). Aggregate fits by fleet are shown in Figure \ref{fig:agg-len-fit}.  The model fits the aggregated lengths for both the commercial and recreational fleet length data generally well.  The commercial fleet shows a wider range of size selected at lower frequencies compared to the recreational fleet which has an aggregated peak around 45 cm approximately. The model overestimated the selectivity for female fish at the largest size relative to observed data from the commercial fleet. The model underestimates the proportion of male fish selected at their peak for both the commercial and recreational fleets.

### Population Trajectory

The predicted spawning output (in millions of eggs) is given in Table \ref{tab:timeseries} and plotted in Figure \ref{fig:ssb}. The predicted spawning output from the base model slowly declines until around the year 2000 and then increases due to several above average recruitments that occurred in the mid- to late-1990s. The population then increases for a short period and declines to the final year of the model. The estimate of total biomass over time is shown in Figure \ref{fig:tot-bio}.

The `r endyr` spawning output relative to unfished equilibrium spawning output is above the target of 40% of unfished spawning output (`r round(model$derived_quants[model$derived_quants$Label == 'Bratio_2021','Value'], 2)`, Figure \ref{fig:depl}). Approximate confidence intervals based on the asymptotic variance estimates show that the uncertainty in the estimated spawning output is relatively large ranging between the management threshold of 25 to approximately 80 percent of unfished. 

The slight dome shape in the final selectivity for the recreational fleet results in a small fraction of large fish that unavailable in recent years (Figure \ref{fig:unavail-bio}). The fraction of large fish unavailable is relatively small portion of the overall biomass and in theory would be available for selection from the commercial fishery.   

The stock-recruit curve resulting from a value of steepness fixed at `r print(model$parameters[model$parameters$Label == "SR_BH_steep","Value"],2)` is shown in Figure \ref{fig:bh-curve}. The estimated annual recruitment and recruitment deviations are shown in  Figures \ref{fig:recruits} and \ref{fig:rec-devs}. Strong recruitment events were estimated to have occured in 1994 and 1997 which resulted in a subsequent increase in biomass during the 2000s. While the largest recruitment deviations were estimated to have occured in these two specific years, the surrounding years also have above average recruitment estimated.  This series of above average recruitment years were likely due to lack of specific information in the length data as to which years had strong recruitment.

### Reference Points

Reference points were calculated using the estimated selectivity and catch distributions among fleets in the most recent year of the model (`r endyr`, Table \ref{tab:referenceES}). Sustainable total yields  were `r round(model$derived_quants[model$derived_quants$Label == 'Dead_Catch_SPR', 'Value'], 2)` mt when using an $SPR_{50\%}$ reference harvest rate. The spawning output equivalent to 40% of the unfished spawning output ($SB_{40\%}$) was `r round(model$derived_quants[model$derived_quants$Label == 'SSB_SPR', 'Value'], 2)` millions of eggs. 

The `r endyr` spawning output relative to unfished equilibrium spawning output is above the target of 40% of unfished spawning output (Figure \ref{fig:depl}). The fishing intensity, $1-SPR$, has bounced above and blow the harvest rate limit ($SPR_{50\%}$) in recent years (Table \ref{tab:timeseries} and Figure \ref{fig:1-spr}). Table \ref{tab:referenceES} shows the full suite of estimated reference points for the base model and Figure \ref{fig:yield} shows the equilibrium curve based on a steepness value fixed at `r model$parameters[model$parameters$Label == "SR_BH_steep","Value"]`.

<!--chapter:end:33results.Rmd-->

## Model Diagnostics

### Convergence

Proper convergence was determined by starting the minimization process from dispersed values of the maximum likelihood estimates to determine if the model found a better minimum. Starting parameters were jittered by 5%. This was repeated 100 times and a better minimum was not found. The model did not experience convergence issues when provided reasonable starting values. Through the jittering done as explained above and likelihood profiles, we are confident that the base model as presented represents the best fit to the data given the assumptions made. There were no difficulties in inverting the Hessian to obtain estimates of variability, although much of the early model investigation was done without attempting to estimate a Hessian. 


### Sensitivity Analyses

A number of sensitivity analyses were conducted.  The majority of the sensitivities conducted was a single exploration from the base model assumptions and/or data, and were not performed in a cumulative fashion.

\begin{enumerate}

  \item Fix natural mortality 10 percent lower at a value of 0.097 per year for both sexes.
  
  \item Fix natural mortality 10 percent higher at a value of 0.119 per year for both sexes.

  \item Fix $L_{\infty}$ 5 percent higher at a value of 52.2 cm for females and 50.5 for males. 
   
  \item Deterministic recruitment from the stock recruitment curve. 

  \item Fix recreational selectivity from 2000 - 2020 to be asymptotic. 

  \item Estimate a single selectivity curve for the recreational fleet that is fixed to be asymptotic.  

  \item Data weighting according to the McAllister-Ianelli method using the weighting values shown in Table \ref{tab:dw}. 
  
  \item Data weighting according to the Dirichlet method where the estimated parameters are shown in Table \ref{tab:dw}. 
  
\end{enumerate}

Likelihood values and estimates of key parameters from each sensitivity are available in Table \ref{tab:sensitivities}.  Plots of the estimated time-series of spawning biomass and relative spawning biomass are shown in Figures \ref{fig:sens-ssb} and \ref{fig:sens-depl}.

The largest change from the base model resulted in the two sensitivities examining alternative selectivity assumptions for the recreational fleet.  Fixing the final selectivity (years 2000-2010) to be asymptotic in this fleet resulted in a more pessimistic estimate in the final years stock size and relative status. In comparison to the base model, the estimates from this sensitivity were generally more extreme; lower log($R_0$), more extreme positive recruitment deviations, and a more variable time series (higher highs and lower lows). Fixing selectivity to by asymptotic and estimating a single selectivity pattern across all years for the recreational fleet also estimated a lower stock size with the stock being more depleted in the final model year. 

A sensitivity of assuming a lower $L_{\infty}$ was also conducted but not presented here. Assuming the $L_{\infty}$ to be lower than the input value resulted in a dramatic and unrealistic shift in stock scale upwards resulting in an unfished population status. 

### Retrospective Analysis

A five-year retrospective analysis was conducted by running the model using data only through 2015, 2016, 2017, 2018, 2019 and 2020. The estimated spawning output was generally consistent with the base model when recent years of data were removed (Figures \ref{fig:retro-ssb} and \ref{fig:retro-depl}).  Removing 3 and 4 years of data resulted in a decline is spawning output relative to the base model likely due to the limited length samples from the recreational fishery available in 2015 and 2016 when retention was prohibited in the Oregon recreational fishery. 

### Likelihood Profiles

Likelihood profiles were conducted for $R_0$, steepness, female maximum length, and female natural mortality values separately. These likelihood profiles were conducted by fixing the parameter at specific values and estimated the remaining parameters based on the fixed parameter value.

In regards to values of $R_0$, the negative log-likelihood was minimized at approximately log($R_0$) of `r round(log(model$derived_quants[model$derived_quants$Label == "Recr_Virgin",2]),2)` (Figure \ref{fig:r0-profile}). Both the commercial and recreational data supported lower log($R_0$) value. Increasing the $R_0$, relative to the value estimated, results in an a sharp increase in stock scale and status (Figure \ref{fig:r0-ssb} and \ref{fig:r0-depl}). 

For steepness, values from approximately 0.30 to 1.0 were supported with the lowest negative log-likelihood occuring at the upper bound of 1.0 (Figure \ref{fig:h-profile}).  Assuming higher or lower steepness values had minimal impact on the unfished and spawning output estimated (Figure \ref{fig:h-ssb}). The estimated relative final stock status ranged between around the minumum threshold (0.25) to above the management target depending upon assuming a lower or higher steepness value (Figure \ref{fig:h-depl}).

The negative log-likelihood profile across female natural mortatliy supported values greater than the fixed value of `r model$parameters[model$parameters$Label == "NatM_p_1_Fem_GP_1","Value"]` (Figure \ref{fig:m-profile}). The estimate stock trajectories assuming lower or higher natural mortality values impacted the estimated unfished spawning output and resulted in stock statuses within the management precautionary zone (between 0.25 - 0.40) and above (Figure \ref{fig:m-ssb} and  \ref{fig:m-depl}). 

A profile across a range of female $L_{\infty}$ values was also conducted (Figure \ref{fig:linf-profile}).  The negative log-likelihood showed support for values between 48 and 50 cm. The $L_{\infty}$ value for female fish in the model was fixed at `r model$parameters[model$parameters$Label == "L_at_Amax_Fem_GP_1","Value"]` based on length-at-age data collected off the Oregon and Washington coast. The stock scale and status is quite variable across alternative $L_{\infty}$ values where assuming lower values resulted in sharp increases in stock scale and status (Figure \ref{fig:linf-ssb} and \ref{fig:linf-depl}).

<!--chapter:end:34diagnostics.Rmd-->

# Management 

## Harvest Projections and Decision Tables

A ten year projection of the base model with catches equal to the estimated ACL for years 2023-2032 with all removals allocated to the recreational fleet (Table \ref{tab:projectionES}). The removals in 2021 and 2022 were set based on the adopted Annual Catch Limits (ACLs) and the percent allocation (49 percent) for Oregon state provided by the PFMC Groundfish Management Team (GMT). 

The decision table uncertainty axes and catch levels to be determined later.

## Evaluation of Scientific Uncertainty

```{r, echo=FALSE, results='asis'}
filein = file.path(general_wd,'management_uncertainty.Rmd')
read_child(filein)
```

<!--chapter:end:40management.Rmd-->

# Acknowledgments

```{r, echo=FALSE, results='asis'}
filein = file.path(general_wd,'acknowledgements.Rmd')
read_child(filein)
```

<!--chapter:end:41acknowledgments.Rmd-->

\clearpage

# References
<!-- If you want to references to appear somewhere before the end, add: -->
<div id="refs"></div>
<!-- where you want it to appear -->
<!-- The following sets the appropriate indentation for the references
  but it cannot be used with bookdown and the make file because it leads
  to a bad pdf.
\noindent
\vspace{-2em}
\setlength{\parindent}{-0.2in}
\setlength{\leftskip}{0.2in}
\setlength{\parskip}{8pt}
 -->

<!--chapter:end:49bibliography.Rmd-->

\clearpage
# Tables

<!-- ======================================================= -->
<!-- ***************    Catches      *********************** --> 
<!-- ======================================================= -->

\input{C:/Assessments/2021/copper_rockfish_2021/write_up/or/tex_tables/Catches_All_Years.tex}

\newpage

<!-- ======================================================= -->
<!-- ***************       Data      *********************** --> 
<!-- ======================================================= -->

\input{C:/Assessments/2021/copper_rockfish_2021/write_up/or/tex_tables/OR_Com_Samples.tex}

\newpage

\input{C:/Assessments/2021/copper_rockfish_2021/write_up/or/tex_tables/or_samples.tex}

\newpage



\input{C:/Assessments/2021/copper_rockfish_2021/write_up/or/tex_tables/len_at_age_data.tex}

\newpage


\input{C:/Assessments/2021/copper_rockfish_2021/write_up/or/tex_tables/or_age_samples.tex}

\newpage


<!-- ======================================================= -->
<!-- ***************    Biology      *********************** --> 
<!-- ======================================================= -->





<!-- ======================================================= -->
<!-- ***********   Model Parameters     ******************** --> 
<!-- ======================================================= -->


```{r, results = 'asis'}

mod_params = model$parameters[-c(grep('Impl',model$parameters$Label),
							     grep('Fore',model$parameters$Label)),
                                (names(model$parameters) %in%
                                c("Num","Label","Value","Phase","Min",
                                  "Max","Status","Parm_StDev",
                                  "Pr_type","Prior","Pr_SD"))] 

mod_params[,'Value'] = round(as.numeric(mod_params[,'Value']),3)                                 

# Combine bounds into one column
mod_params$Min = paste('(', mod_params$Min, ', ', mod_params$Max, ')', sep='')

# Combine prior info to one column
mod_params$PR_type = ifelse(mod_params$Pr_type == 'No_prior' , 'None', paste(mod_params$Pr_type,' (', mod_params$Prior,  ', ', mod_params$Pr_SD, ')', sep = ''))

# Set long value to scientific notation
mod_params[mod_params$Label == "Wtlen_1_Fem",3] = format(mod_params[mod_params$Label == "Wtlen_1_Fem",3], scientific = TRUE)
mod_params[mod_params$Label == "Wtlen_1_Mal",3] = format(as.numeric(mod_params[mod_params$Label == "Wtlen_1_Mal",3]), scientific = TRUE)
mod_params[mod_params$Label == "Eggs_scalar_Fem",3] = format(as.numeric(mod_params[mod_params$Label == "Eggs_scalar_Fem",3]), scientific = TRUE)
mod_params[mod_params$Label == "L_at_Amax_Mal_GP_1",3] = round(as.numeric(mod_params[mod_params$Label == "L_at_Amax_Mal_GP_1",3]), 4)
mod_params[mod_params$Label == "VonBert_K_Mal_GP_1",3] = round(as.numeric(mod_params[mod_params$Label == "VonBert_K_Mal_GP_1",3]), 3)
mod_params[mod_params$Label == "CV_old_Mal_GP_1",3] = round(as.numeric(mod_params[mod_params$Label == "CV_old_Mal_GP_1",3]), 3)

# Remove the max, prior and prior sd columns
drops = c('Max', 'Prior', 'Pr_type', 'Pr_SD', 'Num')
mod_params = mod_params[, !(names(mod_params) %in% drops)]
rownames(mod_params) = c()
mod_params[,"Label"] = gsub("\\_", " ", mod_params[,"Label"])
mod_params[,"PR_type"] = gsub("\\_", " ", mod_params[,"PR_type"])

# Add column names
col_names = c('Parameter',
                         'Value',
                         'Phase',
                         'Bounds',
                         'Status',
                         'SD',
                         'Prior (Exp.Val, SD)')

table_format(x = mod_params,
             caption = "List of parameters used in the base model, including estimated values and standard deviations (SD), bounds (minimum and maximum), estimation phase (negative values not estimated), status (indicates if parameters are near bounds), and prior type information (mean and SD).",
             label = "params",
             align = 'l',
             col_names = col_names,
             longtable = TRUE,
             font_size = 9,
             landscape = TRUE,
             custom_width = TRUE,
             col_to_adjust = c(1,7), 
             width = c("6cm", "4cm"))                         

```
<!-- ======================================================= -->
<!-- ***********    Like Contributions  ******************** --> 
<!-- ======================================================= -->

\include{tex_tables/likelihoods.tex}


<!-- ======================================================= -->
<!-- ***********       Time Series      ******************** --> 
<!-- ======================================================= -->

\input{C:/Assessments/2021/copper_rockfish_2021/write_up/or/tex_tables/TimeSeries.tex}

\newpage

<!-- ======================================================= -->
<!-- ****************     Sensitivities      *************** --> 
<!-- ======================================================= -->

\input{C:/Assessments/2021/copper_rockfish_2021/write_up/or/tex_tables/sensitivities.tex}

\newpage

```{r, results = 'asis'}
tab = read.csv(file.path(mod_loc, 'tables', 'data_weights.csv'))

col_names = c('Method',
			  'Commercial Lengths',
              'Recreational Lengths')
table_format(x = tab,
             caption = "Data weights applied by each alternative data weighting methods.",
             label = "dw",
             align = 'l',
             col_names = col_names)
```

\newpage

<!-- ======================================================= -->
<!-- ********  Reference Points & Management *************** --> 
<!-- ======================================================= -->

\input{C:/Assessments/2021/copper_rockfish_2021/write_up/or/tex_tables/e_ReferencePoints_ES.tex}

\newpage

\input{C:/Assessments/2021/copper_rockfish_2021/write_up/or/tex_tables/g_Projections_ES.tex}

\newpage

<!--chapter:end:52tables.Rmd-->

\clearpage
# Figures


<!-- ====================================================================== --> 
<!-- ******************* Data Used in the Model *************************** --> 
<!-- ====================================================================== --> 

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "data_plot.png"), 
caption = "Summary of data sources used in the base model",
label = 'data-plot')
```	

<!-- ====================================================================== -->  
<!-- ****************** Catches Used in the Model ************************* --> 
<!-- ====================================================================== -->  

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "catch2 landings stacked.png"), 
caption = "Catches by fleet used in the base model",
label = 'catch')
```	


<!-- ====================================================================== -->
<!-- ****************   Commercial Length Samples    ********************** --> 
<!-- ====================================================================== -->

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "comp_lendat_bubflt1mkt0_page2.png"), 
caption = "Length composition data from the commercial fleet",
label = 'com-len-data')
```

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "comp_lendat_data_weighting_TA1.8_OR_Commercial.png"), 
caption = "Mean length for commercial fleet with 95 percent confidence intervals",
label = 'mean-com-len-data')
```

<!-- ====================================================================== -->
<!-- **************** Recreational Length Samples    ********************** --> 
<!-- ====================================================================== -->

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "comp_lendat_bubflt2mkt0_page3.png"), 
caption = "Length composition data from the recreational fleet",
label = 'rec-len-data')
```

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "comp_lendat_data_weighting_TA1.8_OR_Recreational.png"), 
caption = "Mean length for recreational fleet with 95 percent confidence intervals",
label = 'mean-rec-len-data')
```

<!-- ====================================================================== -->
<!-- *************************     Biology     **************************** --> 
<!-- ====================================================================== -->

```{r, echo=FALSE, results='asis'}

filein = file.path(general_wd,'figures_biology.Rmd')
read_child(filein)

```


<!-- ====================================================================== -->
<!-- *********************    Selectivity            ********************** --> 
<!-- ====================================================================== -->

```{r, results = 'asis'}
add_figure(
filein = file.path(getwd(), "figs", "selectivity.png"),
caption = "Selectivity at length by fleet",
label = 'selex')
```


<!-- ====================================================================== -->
<!-- ****************** Fit to the Length Data **************************** --> 
<!-- ====================================================================== -->


```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "comp_lenfit_residsflt1mkt0_page2.png"), 
caption = "Pearson residuals for commercial fleet. Closed bubble are positive residuals (observed > expected) and open bubbles are negative residuals (observed < expected)",
label = 'com-pearson')
```

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "comp_lenfit_data_weighting_TA1.8_OR_Commercial.png"), 
caption = "Mean length for commercial lengths with 95 percent confidence intervals based on current samples sizes",
label = 'com-mean-len-fit')
```

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "comp_lenfit_residsflt2mkt0_page3.png"), 
caption = "Pearson residuals for recreational fleet. Closed bubble are positive residuals (observed > expected) and open bubbles are negative residuals (observed < expected)",
label = 'rec-pearson')
```

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "comp_lenfit_data_weighting_TA1.8_OR_Recreational.png"), 
caption = "Mean length for recreational lengths with 95 percent confidence intervals based on current samples sizes",
label = 'rec-mean-len-fit')
```

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "comp_lenfit__aggregated_across_time.png"), 
caption = "Aggregated length comps over all years",
label = 'agg-len-fit')
```

<!-- ====================================================================== -->
<!-- ******************      Time Series       **************************** --> 
<!-- ====================================================================== -->

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "ts7_Spawning_output_with_95_asymptotic_intervals_intervals.png"), 
caption = "Estimated time series of spawning output",
label = 'ssb')
```

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "ts1_Total_biomass_(mt).png"), 
caption = "Estimated time series of total biomass",
label = 'tot-bio')
```

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "ts9_Fraction_of_unfished_with_95_asymptotic_intervals_intervals.png"), 
caption = "Estimated time series of fraction of unfished spawning output",
label = 'depl')
```

```{r, results = 'asis'}
add_figure(
filein = file.path(getwd(), "figs", "unavailable_biomass.png"),
caption = "Proportion of biomass unavailable due to selectivity for small and large fish.",
label = 'unavail-bio')
```

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "SR_curve.png"), 
caption = "Stock-recruit curve. Point colors indicate year, with warmer colors indicating earlier years and cooler colors in showing later years",
label = 'bh-curve')
```


```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "ts11_Age-0_recruits_(1000s)_with_95_asymptotic_intervals.png"), 
caption = "Estimated time series of age-0 recruits (1000s)",
label = 'recruits')
```

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "recdevs2_withbars.png"), 
caption = "Estimated time series of recruitment deviations",
label = 'rec-devs')
```


<!-- ====================================================================== -->
<!-- ******************    Reference Points    **************************** --> 
<!-- ====================================================================== -->


```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "SPR2_minusSPRseries.png"), 
caption = "Estimated 1 - relative spawning ratio (SPR) by year",
label = '1-spr')
```

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "yield2_yield_curve_with_refpoints.png"), 
caption = "Equilibrium yield curve for the base case model. Values are based on the 2020
fishery selectivity and with steepness fixed at 0.72",
label = 'yield')
```


<!-- ====================================================================== -->
<!-- ******************       Sensitivity     ***************************** --> 
<!-- ====================================================================== -->


```{r, echo=FALSE, results='asis'}
sens_wd = file.path(substr(mod_loc, 1, 50), "_sensitivities", "_plots")
nm = paste0(substr(mod_loc, 52, 99), "_compare2_spawnbio_uncertainty.png")
add_figure(
filein = file.path(sens_wd, nm),
caption = "Change in estimated spawning output by sensitivity",
label = 'sens-ssb')
```

```{r, echo=FALSE, results='asis'}
nm = paste0(substr(mod_loc, 52, 99), "_compare4_Bratio_uncertainty.png")
add_figure(
filein = file.path(sens_wd, nm),
caption = "Change in estimated fraction unfished by sensitivity",
label = 'sens-depl')
```

<!-- ====================================================================== -->
<!-- ******************      Likelihoods      ***************************** --> 
<!-- ====================================================================== -->

```{r, echo=FALSE, results='asis'}
filein = file.path(general_wd,'figures_likelihoods.Rmd')
read_child(filein)
```

<!-- ====================================================================== -->
<!-- ******************     Retrospectives    ***************************** --> 
<!-- ====================================================================== -->

```{r, echo=FALSE, results='asis'}
filein = file.path(general_wd,'figures_retro.Rmd')
read_child(filein)
```


\newpage

<!--chapter:end:53figures.Rmd-->

\clearpage

# Appendix A. Detailed Fit to Length Composition Data 


```{r, results='asis'}
plot_info = read.csv(file.path(mod_loc, "plots", "plotinfotable_for_doc.csv"))
len_fit = plot_info[which(plot_info$category == "LenComp"), ]
plot.vec = grep("comp_lenfit_flt", len_fit$label)
filein = file.path(mod_loc, "plots")

for (a in plot.vec){
	cap = len_fit$caption[a]
	lab = len_fit$label[a]
	add_figure(filein = file.path(filein, len_fit$file[a]), 
			   caption = cap, 
			   label = lab)
}

```

<!--chapter:end:54appendix.Rmd-->

